(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const y={mass:5e4,radius:5,vx:0,vy:0,fixed:!1,walls:!0},h={...y},i={mass:document.getElementById("mass"),radius:document.getElementById("radius"),vx:document.getElementById("vx"),vy:document.getElementById("vy"),fixed:document.getElementById("fixed"),walls:document.getElementById("walls"),count:document.getElementById("star-count"),frameRate:document.getElementById("frame-rate"),clearBtn:document.getElementById("clear-btn")},m=(s,t)=>{if(s==="fixed"){h.fixed=t.checked;return}else if(s=="walls"){h.walls=t.checked;return}const e=parseFloat(t.value);isNaN(e)?t.classList.add("error"):(t.classList.remove("error"),h[s]=e)},b=()=>{i.mass.value=y.mass.toString(),i.radius.value=y.radius.toString(),i.vx.value=y.vx.toString(),i.vy.value=y.vy.toString(),i.fixed.checked=y.fixed,i.walls.checked=y.walls,i.mass.addEventListener("input",()=>m("mass",i.mass)),i.radius.addEventListener("input",()=>m("radius",i.radius)),i.vx.addEventListener("input",()=>m("vx",i.vx)),i.vy.addEventListener("input",()=>m("vy",i.vy)),i.fixed.addEventListener("change",()=>m("fixed",i.fixed)),i.walls.addEventListener("change",()=>{m("walls",i.walls),L()}),i.clearBtn.addEventListener("click",()=>{l.fillStyle="#282828",l.fillRect(0,0,u,f),c.length=0,console.log("Clear requested")})},F=s=>{i.count&&(i.count.innerText=s.toString())},A=s=>{i.frameRate&&(i.frameRate.innerText=s.toString())};function E(){const s=Math.random()*360,t=80+Math.random()*20,e=50+Math.random()*10;return`hsl(${s}, ${t}%, ${e}%)`}class o{static thickness=5;wallType;x;y;width;height;color=E();constructor(t){this.wallType=t,t=="left"?(this.x=0,this.y=0,this.width=o.thickness,this.height=f):t=="right"?(this.x=u-o.thickness,this.y=0,this.width=o.thickness,this.height=f):t=="top"?(this.x=o.thickness,this.y=0,this.width=u-2*o.thickness,this.height=o.thickness):(this.x=o.thickness,this.y=f-o.thickness,this.width=u-2*o.thickness,this.height=o.thickness)}update(){}draw(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height)}}const v=document.querySelector("#canvas"),l=v.getContext("2d"),u=window.innerWidth,f=window.innerHeight,k=100;let c=[],g=[],x=0,w=0;I();L();b();function I(){v.addEventListener("click",s=>M(s.x,s.y)),v.addEventListener("mousemove",s=>{s.altKey&&M(s.x,s.y)}),v.width=u,v.height=f,requestAnimationFrame(S)}function L(){if(!h.walls){g.length=0;return}g.push(new o("left"),new o("right"),new o("top"),new o("bottom"))}function M(s,t){console.log("adding new star");const e=new B(s,t);e.mass=h.mass,e.radius=h.radius,e.isFixed=h.fixed,e.vx=h.vx,e.vy=h.vy,c.push(e)}function S(s){l.fillStyle="rgba(40,40,40,0.08)",l.fillRect(0,0,u,f),x==0&&(x=s),s-w>=1e3&&(A(Math.round(1e3/(s-x))),w=s);const t=Math.min(s-x,10)/1e3;x=s;for(const e of c)e.computeAcceleration();for(const e of c)e.update(t),e.draw(l);for(const e of g)e.draw(l);l.font="20px monospace",l.fillStyle="white",c=c.filter(e=>!e.markedForDeletion),F(c.length),requestAnimationFrame(S)}class B{MAX_VX=2500;MAX_VY=2500;x;y;color=E();vx=0;vy=0;mass=1e3;markedForDeletion=!1;radius=5;isFixed=!1;ax=0;ay=0;constructor(t,e){this.x=t,this.y=e}computeAcceleration(){[this.ax,this.ay]=[0,0];for(const t of c){if(t==this)continue;const[e,a]=t.getGravitationalFieldAt(this.x,this.y);this.ax+=e,this.ay+=a}}update(t){if(!this.isFixed){this.vx+=this.ax*t,this.vy+=this.ay*t,this.vx=Math.max(-this.MAX_VX,Math.min(this.MAX_VX,this.vx)),this.vy=Math.max(-this.MAX_VY,Math.min(this.MAX_VY,this.vy));for(const e of g)if(e.wallType==="left"){const a=e.x+e.width;this.x-this.radius<a&&(this.x=a+this.radius,this.vx=Math.abs(this.vx))}else if(e.wallType==="right"){const a=e.x;this.x+this.radius>a&&(this.x=a-this.radius,this.vx=-Math.abs(this.vx))}else if(e.wallType==="top"){const a=e.y+e.height;this.y-this.radius<a&&(this.y=a+this.radius,this.vy=Math.abs(this.vy))}else if(e.wallType==="bottom"){const a=e.y;this.y+this.radius>a&&(this.y=a-this.radius,this.vy=-Math.abs(this.vy))}this.x+=this.vx*t,this.y+=this.vy*t,this.markedForDeletion=this.x<-10*u||this.x>10*u||this.y<-10*f||this.y>10*f}}draw(t){t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill()}getGravitationalFieldAt(t,e){const n=this.x-t,r=this.y-e,d=Math.sqrt(n*n+r*r+625);let p=k*this.mass/(d*d);return[p*n/d,p*r/d]}}
